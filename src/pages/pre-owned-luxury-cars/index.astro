---
import Layout from '../../layouts/Layout.astro';
import { getCities, getDealersByCitySlug } from '../../lib/dealers';
import CityCard from '../../components/CityCard.astro';
import cityCovers from '../../data/city-covers.json';

const cities = getCities();
const jsonLd = {
	'@context': 'https://schema.org',
	'@type': 'CollectionPage',
	name: 'Pre-owned Luxury Cars by City (India)',
	description: 'Browse pre-owned luxury car dealers by city across India.',
};

const previews = new Map<string, string | undefined>();
for (const c of cities) {
	const rawCover = (cityCovers as any)?.[c.citySlug] as any;
	const cover = (typeof rawCover === 'string' ? rawCover : rawCover?.url) as string | undefined;
	if (cover) {
		previews.set(c.citySlug, cover);
	} else {
		// Fallback to finding a dealer with an image
		const dealers = getDealersByCitySlug(c.citySlug);
		const dealerImage = dealers.find((d) => !!d.imageUrl)?.imageUrl;
		if (dealerImage) {
			previews.set(c.citySlug, dealerImage);
		}
	}
}
---

<Layout
	title="Luxury Car Dealerships by City | IndianLuxuryCars.com"
	description="Browse pre-owned luxury car dealers by city across India."
	jsonLd={jsonLd}
>
	<div class="max-w-[1180px] mx-auto px-6 py-12 lg:py-20">
		<header class="mb-16 max-w-3xl">
			<h1 class="text-4xl md:text-5xl font-serif text-white mb-6">Exclusive Locations</h1>
			<p class="text-xl text-white/60 font-light leading-relaxed">
				Explore our curated network of premium dealerships across {cities.length} major cities in India. 
				Find verified partners in your region.
			</p>
		</header>

		<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
			{cities.map((c) => (
				<CityCard
					cityName={c.cityName}
					citySlug={c.citySlug}
					count={c.count}
					imageUrl={previews.get(c.citySlug)}
				/>
			))}
		</div>
	</div>
</Layout>
