---
import Layout from '../../layouts/Layout.astro';
import { getCities, getDealersByCitySlug } from '../../lib/dealers';
import CityCard from '../../components/CityCard.astro';
import cityCovers from '../../data/city-covers.json';

const cities = getCities();
const jsonLd = {
	'@context': 'https://schema.org',
	'@type': 'CollectionPage',
	name: 'Pre-owned Luxury Cars by City (India)',
	description: 'Browse pre-owned luxury car dealers by city across India.',
};

const previews = new Map<string, string | undefined>();
for (const c of cities) {
	const rawCover = (cityCovers as any)?.[c.citySlug] as any;
	const cover = (typeof rawCover === 'string' ? rawCover : rawCover?.url) as string | undefined;
	if (cover) {
		previews.set(c.citySlug, cover);
		continue;
	}
	const d = getDealersByCitySlug(c.citySlug).find((x) => !!x.imageUrl);
	previews.set(c.citySlug, d?.imageUrl);
}
---

<Layout
	title="Pre-owned Luxury Cars by City (India) | IndianLuxuryCars.com"
	description="Browse pre-owned luxury car dealers by city across India."
	jsonLd={jsonLd}
>
	<div class="container">
		<header class="card flex flex-col items-start gap-4 mb-5 p-5 bg-[radial-gradient(1000px_520px_at_12%_10%,rgba(214,178,94,0.18),rgba(0,0,0,0)),radial-gradient(900px_520px_at_88%_10%,rgba(99,102,241,0.14),rgba(0,0,0,0)),rgba(255,255,255,0.05)] sm:flex-row sm:items-start sm:justify-between sm:p-6">
			<div class="heroText">
				<div class="text-[11px] tracking-[0.08em] uppercase text-[rgba(238,242,255,0.72)] mb-1.5">Indian Luxury Cars</div>
				<h1 class="m-0 text-[28px] tracking-[-0.02em] sm:text-[32px]">Browse cities</h1>
				<p class="text-muted">Verified dealers, reviews, locations â€” all in one place.</p>
				<div class="flex flex-wrap gap-[10px] mt-3 w-full sm:w-auto">
					<a class="btn primary" href="/contact">Get offers</a>
					<a class="btn ghost" href="/">Home</a>
				</div>
			</div>
			<div class="flex gap-[10px] w-full justify-start sm:w-auto sm:justify-end">
				<div class="py-2.5 px-3.5 rounded-xl border border-border bg-[rgba(0,0,0,0.18)] min-w-[80px] text-center sm:min-w-[92px]">
					<div class="font-[850] text-xl tracking-[-0.02em] sm:text-[22px]">{cities.length}</div>
					<div class="text-muted text-xs">cities</div>
				</div>
			</div>
		</header>

		<div class="grid grid-cols-1 gap-3 sm:grid-cols-3 lg:grid-cols-4">
			{cities.map((c) => (
				<CityCard
					cityName={c.cityName}
					citySlug={c.citySlug}
					count={c.count}
					imageUrl={previews.get(c.citySlug)}
				/>
			))}
		</div>
	</div>
</Layout>
