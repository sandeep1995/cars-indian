---
import Layout from '../../../layouts/Layout.astro';
import { getCities, getDealersByCitySlug, isLikelyUsedLuxuryDealer } from '../../../lib/dealers';
import DealerCard from '../../../components/DealerCard.astro';
import cityCovers from '../../../data/city-covers.json';

export function getStaticPaths() {
	return getCities().map((c) => ({
		params: { city: c.citySlug },
		props: { cityName: c.cityName },
	}));
}

const { cityName } = Astro.props as { cityName: string };
const citySlug = Astro.params.city!;
const dealers = getDealersByCitySlug(citySlug);
const featured = dealers.filter((d) => isLikelyUsedLuxuryDealer(d)).slice(0, 20);

const title = `${cityName} Pre-owned Luxury Car Dealers | IndianLuxuryCars.com`;
const description = `Find pre-owned luxury car dealers in ${cityName}. Browse reviews, locations, and contact details.`;

const jsonLd = {
	'@context': 'https://schema.org',
	'@type': 'CollectionPage',
	name: title,
	description,
};

const rawCover = (cityCovers as any)?.[citySlug] as any;
const coverUrl = (typeof rawCover === 'string' ? rawCover : rawCover?.url) as string | undefined;
const heroImage = coverUrl || dealers.find((d) => !!d.imageUrl)?.imageUrl;
---

<Layout title={title} description={description} jsonLd={jsonLd}>
	<div class="max-w-[1180px] mx-auto px-4 py-5 sm:px-5 sm:py-6 lg:px-6 lg:py-[26px]">
		<header class="relative rounded-2xl overflow-hidden border border-[rgba(255,255,255,0.12)] bg-[rgba(255,255,255,0.06)] mb-4 min-h-[180px] sm:rounded-[18px] sm:min-h-[200px]">
			<div class="absolute inset-0" aria-hidden="true">
				{heroImage ? (
					<img src={heroImage} alt="" loading="eager" decoding="async" referrerpolicy="no-referrer" class="w-full h-full object-cover saturate-[1.05] contrast-[1.05]" />
				) : (
					<div class="w-full h-full bg-[radial-gradient(1100px_520px_at_10%_10%,rgba(214,178,94,0.22),rgba(0,0,0,0)),radial-gradient(1000px_520px_at_90%_10%,rgba(99,102,241,0.16),rgba(0,0,0,0)),rgba(255,255,255,0.06)]"></div>
				)}
				<div class="absolute inset-0 bg-gradient-to-b from-[rgba(0,0,0,0.15)] via-[rgba(0,0,0,0.7)] to-[rgba(0,0,0,0.85)]"></div>
			</div>
			<div class="relative z-[1] p-4 flex flex-col gap-2 justify-end min-h-[180px] sm:p-5 sm:min-h-[200px]">
				<nav class="flex gap-2 items-center flex-wrap mb-1.5 text-[13px] sm:text-sm sm:gap-2.5">
					<a href="/" class="text-[rgba(238,242,255,0.88)] no-underline">Home</a>
					<span class="text-[rgba(250,251,255,0.72)] text-xs">/</span>
					<a href="/pre-owned-luxury-cars" class="text-[rgba(238,242,255,0.88)] no-underline">Cities</a>
					<span class="text-[rgba(250,251,255,0.72)] text-xs">/</span>
					<span>{cityName}</span>
				</nav>
				<h1 class="m-0 text-[26px] tracking-[-0.02em] sm:text-[30px]">{cityName}</h1>
				<p class="text-[rgba(250,251,255,0.72)]">{dealers.length} dealers</p>
				<div class="mt-1.5 flex flex-wrap gap-2">
					<a class="inline-flex items-center justify-center gap-2 px-[14px] py-[10px] rounded-full border border-[rgba(255,255,255,0.22)] bg-[linear-gradient(135deg,rgba(214,178,94,0.98),rgba(241,212,138,0.96),rgba(169,124,43,0.9))] text-[rgba(18,12,2,0.92)] no-underline font-bold text-sm tracking-[-0.01em] whitespace-nowrap transition-all duration-[140ms] ease-in-out hover:brightness-[1.04] hover:saturate-[1.02] sm:py-[11px] sm:gap-[10px]" href="/contact">Get offers</a>
					<a class="inline-flex items-center justify-center gap-2 px-[14px] py-[10px] rounded-full border border-[rgba(255,255,255,0.14)] bg-transparent text-[rgba(250,251,255,0.96)] no-underline font-bold text-sm tracking-[-0.01em] whitespace-nowrap transition-all duration-[140ms] ease-in-out hover:bg-[rgba(255,255,255,0.06)] hover:border-[rgba(255,255,255,0.18)] hover:-translate-y-px hover:shadow-[0_18px_46px_rgba(0,0,0,0.35)] sm:py-[11px] sm:gap-[10px]" href="/pre-owned-luxury-cars">All cities</a>
				</div>
			</div>
		</header>

		{featured.length ? (
			<section class="bg-gradient-to-b from-[rgba(255,255,255,0.065)] to-[rgba(255,255,255,0.04)] border border-[rgba(255,255,255,0.12)] rounded-[18px] shadow-[0_14px_34px_rgba(0,0,0,0.35)] p-[18px] my-[18px] mb-3.5">
				<h2 class="m-0 mb-2.5 text-lg">Featured dealers</h2>
				<div class="grid grid-cols-1 gap-2.5 sm:grid-cols-2 lg:grid-cols-3">
					{featured.map((d) => (
						<DealerCard dealer={d} href={`/pre-owned-luxury-cars/${citySlug}/${d.dealerSlug}`} />
					))}
				</div>
			</section>
		) : null}

		<section class="bg-gradient-to-b from-[rgba(255,255,255,0.065)] to-[rgba(255,255,255,0.04)] border border-[rgba(255,255,255,0.12)] rounded-[18px] shadow-[0_14px_34px_rgba(0,0,0,0.35)] p-[18px] my-[18px] mb-3.5">
			<h2 class="m-0 mb-2.5 text-lg">All dealers</h2>
			<div class="grid grid-cols-1 gap-2.5 sm:grid-cols-2 lg:grid-cols-3">
				{dealers.map((d) => (
					<DealerCard dealer={d} href={`/pre-owned-luxury-cars/${citySlug}/${d.dealerSlug}`} />
				))}
			</div>
		</section>
	</div>
</Layout>
