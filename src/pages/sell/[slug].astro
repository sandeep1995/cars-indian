---
import SellCarCityPage from '../../components/SellCarCityPage.astro';
import { getCities } from '../../lib/dealers';
import { slugify } from '../../lib/slug';
import brands from '../../data/luxury-brands.json';

export const prerender = false;

const slug = Astro.params.slug!;

// Supported patterns:
// - /sell/luxury-cars-in-<citySlug>
// - /sell/<brandSlug>-in-<citySlug>
const citySlug = slug.split('-in-').at(-1) || '';
const brandSlugPart = slug.includes('-in-') ? slug.slice(0, slug.lastIndexOf('-in-')) : '';

const cities = getCities();
const cityObj = cities.find((c) => c.citySlug === citySlug);
const city = cityObj?.cityName ?? citySlug;

const normalizedBrands = (brands as string[]).map((b) => ({ brand: b, slug: slugify(b) }));
const brand =
	brandSlugPart && brandSlugPart !== 'luxury-cars'
		? normalizedBrands.find((b) => b.slug === brandSlugPart)?.brand
		: undefined;

if (!cityObj) {
	Astro.response.status = 404;
}
---

<SellCarCityPage city={city} citySlug={citySlug} brand={brand} />
